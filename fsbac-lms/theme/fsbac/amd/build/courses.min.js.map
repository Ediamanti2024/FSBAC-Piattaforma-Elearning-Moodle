{"version":3,"file":"courses.min.js","sources":["../src/courses.js"],"sourcesContent":["\nimport $ from 'jquery';\nimport * as Filters from 'theme_fsbac/filters';\nimport * as Templates from 'core/templates';\n\nlet OFFSET_PAGINATION = 12;\n\nconst EMPTY_VALUE = '-';\nlet courses = [];\nlet coursesFilters = [];\nlet currentPage = 1;\n\n\nconst TYPE_FILTER = {\n    ORDER: 'order',\n    TEXT: 'text',\n    TAG: 'tag',\n    PROGRAM: 'program',\n    TEACHERS: 'teachers',\n    TYPE: 'type',\n    TIME: 'time',\n    PATHS: 'paths',\n    LEVEL: 'level',\n    DURATION: 'duration',\n    CERTICATE: 'certificate'\n};\n\nlet filterSet = {}\n\nconst setPagination = () => {\n    const total = coursesFilters.length;\n    if (total !== 0 && total > OFFSET_PAGINATION) {\n\n        const numPages = Math.ceil(total / OFFSET_PAGINATION);\n\n        const pages = [];\n        for (let i = 1; i <= numPages; i++) {\n            pages.push({\n                active: i === currentPage,\n                page: i\n            });\n        }\n        const disabledNext = currentPage === numPages;\n        const disabledPrev = currentPage === 1;\n        const container = $('.fsbac-pagination-container');\n        Templates.render(`theme_fsbac/components/pagination/index`, { pages, disabledNext, disabledPrev }).then((html, js) => {\n            Templates.replaceNodeContents(container, html, js);\n        });\n    } else {\n        $('.fsbac-pagination-container').hide();\n    }\n\n    setViewCourses();\n};\n\nconst setViewCourses = () => {\n\n    const start = ((currentPage - 1) * OFFSET_PAGINATION);\n    const end = currentPage * OFFSET_PAGINATION;\n    const courses = coursesFilters.slice(start, end);\n    const isPath = $('#page-theme-fsbac-pages-paths').length > 0;\n    const container = $('.fsbac-cards-courses');\n\n    const tmp = isPath ? `theme_fsbac/pages/paths/view` : `theme_fsbac/pages/courses/view`;\n    Templates.render(tmp, { courses }).then((html, js) => {\n        Templates.replaceNodeContents(container, html, js);\n    });\n};\n\nconst setFilter = (type, value) => {\n\n    filterSet = {\n        ...filterSet,\n        [type]: value\n    };\n\n    if (!value || value === EMPTY_VALUE) {\n        delete filterSet[type];\n    }\n\n    let courses = [...c];\n\n    Object.keys(filterSet).forEach(key => {\n        const value = filterSet[key];\n        courses = applyFilter(key, value, courses)\n    })\n\n    coursesFilters = [...courses];\n}\nconst applyFilter = (type, value, coursesNew) => {\n    //let coursesNew = [...c];\n    if (type === TYPE_FILTER.ORDER) {\n        const values = filtersByOrder(coursesNew, value);\n        if (values) {\n            coursesNew = [...values];\n        }\n    }\n\n    if (type === TYPE_FILTER.TAG) {\n        const values = filtersByTag(coursesNew, value);\n        if (values) {\n            coursesNew = [...values];\n        }\n    }\n\n    if (type === TYPE_FILTER.PROGRAM) {\n        const values = filtersByProgram(coursesNew, value);\n        if (values) {\n            coursesNew = [...values];\n        }\n    }\n    if (type === TYPE_FILTER.TEACHERS) {\n        const values = filtersByTeachers(coursesNew, value);\n        if (values) {\n            coursesNew = [...values];\n        }\n    }\n\n    if (type === TYPE_FILTER.TYPE) {\n        const values = filtersByType(coursesNew, value);\n        if (values) {\n            coursesNew = [...values];\n        }\n    }\n\n    if (type === TYPE_FILTER.TIME) {\n        const values = filtersByTime(coursesNew, value);\n        if (values) {\n            coursesNew = [...values];\n        }\n    }\n\n    if (type === TYPE_FILTER.PATHS) {\n        const values = filtersByPath(coursesNew, value);\n        if (values) {\n            coursesNew = [...values];\n        }\n    }\n\n    if (type === TYPE_FILTER.LEVEL) {\n        const values = filtersByLevel(coursesNew, value);\n        if (values) {\n            coursesNew = [...values];\n        }\n    }\n    if (type === TYPE_FILTER.DURATION) {\n        const values = filtersByDuration(coursesNew, value);\n        if (values) {\n            coursesNew = [...values];\n        }\n    }\n\n    if (type === TYPE_FILTER.CERTICATE) {\n        const values = filtersByCerticate(coursesNew, value);\n        if (values) {\n            coursesNew = [...values];\n        }\n    }\n\n\n\n\n    if (type === TYPE_FILTER.TEXT && value) {\n        coursesNew = [...filtersByText(coursesNew, value)];\n    }\n\n    return [...coursesNew];\n}\n\nconst filterSelect = (e) => {\n    const current$ = $(e.currentTarget);\n    const type = current$.data('type');\n    const elmType = $(e.currentTarget).attr('type');\n    let value = current$.val();\n    if (elmType === 'checkbox') {\n        value = $(e.currentTarget).prop('checked');\n    }\n\n    setFilter(type, value)\n};\n\n\n\nconst filtersByText = (courses, value) => {\n    const rg = new RegExp(value, 'gi');\n    return courses.filter(({ fullname }) => fullname.search(rg) !== -1);\n};\n\nconst filtersByProgram = (courses, value) => {\n    if (value === EMPTY_VALUE) {\n        return null;\n    }\n    const rg = new RegExp(value, 'gi');\n    return courses.filter(({ programma }) => (programma || '').search(rg) !== -1);\n};\n\nconst filtersByTeachers = (courses, value) => {\n    if (value === EMPTY_VALUE) {\n        return null;\n    }\n    const rg = new RegExp(value, 'gi');\n    return courses.filter(({ autore }) => (autore || '').search(rg) !== -1);\n};\n\nconst filtersByTag = (courses, value) => {\n    if (value === EMPTY_VALUE) {\n        return null;\n    }\n    return courses.filter(({ tags }) => tags.some(tag => tag === value));\n};\n\nconst filtersByPath = (courses, value) => {\n    if (value === EMPTY_VALUE) {\n        return null;\n    }\n    return courses.filter(({ paths }) => paths.some(p => p.toString() === value));\n};\n\nconst filtersByTime = (courses, value) => {\n    if (value === EMPTY_VALUE) {\n        return null;\n    }\n    return courses.filter(({ enddate_fascia }) => enddate_fascia === value);\n};\n\nconst filtersByType = (courses, value) => {\n    if (value === EMPTY_VALUE) {\n        return null;\n    }\n    return courses.filter(({ tipologia }) => tipologia === value);\n};\n\nconst filtersByLevel = (courses, value) => {\n    if (value === EMPTY_VALUE) {\n        return null;\n    }\n    return courses.filter(({ livello }) => livello === value);\n};\n\nconst filtersByDuration = (courses, value) => {\n    return courses.filter(({ duration }) => duration >= value.start && duration <= value.end);\n};\n\nconst filtersByCerticate = (courses, value) => {\n\n    return value ? courses.filter(({ isCertificate }) => isCertificate) : courses\n\n};\n\n\nconst filtersByOrder = (courses, value) => {\n    if (value === EMPTY_VALUE) {\n        return null;\n    }\n    if (value === 'date_start') {\n        return courses.sort(function (a, b) { return a.startdate - b.startdate; });\n    }\n\n    if (value === 'a_z') {\n        return courses.sort((a, b) => a.fullname.localeCompare(b.fullname, 'es', { sensitivity: 'base' }));\n    }\n    if (value === 'z_a') {\n        return courses.sort((a, b) => a.fullname.localeCompare(b.fullname, 'es', { sensitivity: 'base' })).reverse();\n    }\n    return null;\n};\nconst submitFilter = () => {\n    $('.fsbac-cards-courses').show();\n    $('.fsbac-empty-values').hide();\n    Filters.closeFilter();\n    setPagination();\n    if (coursesFilters.length === 0) {\n        $('.fsbac-empty-values').show();\n        $('.fsbac-cards-courses').hide();\n        return;\n    }\n}\n\nexport const init = (c, config) => {\n    const { offset, params } = config || {};\n    if (offset) { OFFSET_PAGINATION = offset; }\n    courses = c;\n    window.c = courses;\n    coursesFilters = [...c];\n    Filters.initEvent();\n\n    Filters.initFilterSliderRange('slider-1', 'slider-2', (value) => {\n\n        setFilter(TYPE_FILTER.DURATION, value);\n\n    });\n    $('.fsbac-select-fiters').on('change', 'select', filterSelect);\n\n    $('.fsbac-filters-input-search').on('keyup', 'input', filterSelect);\n\n    $('.fsbac-filters-input-search').on('keyup', 'input', (event) => {\n        if (event.key.charCodeAt() === 69) {\n            submitFilter();\n        }\n    });\n\n    $('.fsbac-filters-checkbox').on('change', 'input', filterSelect);\n\n    $('.fsbac-filters-input-search').on('click', '.submit-filter', () => {\n        submitFilter();\n    });\n    $('.fsbac-pagination-container').on('click', '.fsbac-button-pagination', (e) => {\n        const $current = $(e.currentTarget);\n        const page = $current.data('page');\n\n        if (page === 'next') {\n            currentPage = currentPage + 1;\n        }\n        if (page === 'prev') {\n            currentPage = currentPage - 1;\n        }\n        if (page !== 'prev' && page !== 'next') {\n            currentPage = page;\n        }\n        setPagination();\n    });\n\n    if (params) {\n        Object.keys(params).map((key) => {\n            const value = params[key];\n            $(`.form-group #${key}`).val(value)\n            setFilter(key, value);\n        })\n    }\n\n    setPagination()\n\n};"],"names":["OFFSET_PAGINATION","courses","coursesFilters","currentPage","TYPE_FILTER","filterSet","setPagination","total","length","numPages","Math","ceil","pages","i","push","active","page","disabledNext","disabledPrev","container","Templates","render","then","html","js","replaceNodeContents","hide","setViewCourses","start","end","slice","isPath","tmp","setFilter","type","value","c","Object","keys","forEach","key","applyFilter","coursesNew","values","filtersByOrder","filtersByTag","filtersByProgram","filtersByTeachers","filtersByType","filtersByTime","filtersByPath","filtersByLevel","filtersByDuration","filtersByCerticate","filtersByText","filterSelect","e","current$","currentTarget","data","elmType","attr","val","prop","rg","RegExp","filter","_ref","fullname","search","_ref2","programma","_ref3","autore","_ref4","tags","some","tag","_ref5","paths","p","toString","_ref6","enddate_fascia","_ref7","tipologia","_ref8","livello","_ref9","duration","_ref10","isCertificate","sort","a","b","startdate","localeCompare","sensitivity","reverse","submitFilter","show","Filters","closeFilter","config","offset","params","window","initEvent","initFilterSliderRange","on","event","charCodeAt","map"],"mappings":"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"}